!function(){"use strict";window.chatboxAdmin={},chatboxAdmin.commandHandler={},chatboxAdmin.scriptHandler={},chatboxAdmin.dataHandler={},chatboxAdmin.ui={},chatboxAdmin.ui.init=[],chatboxAdmin.socketEvent={};var e=chatbox.utils,t=chatboxAdmin.socketEvent,o=chatboxAdmin.ui;chatboxAdmin.refreshIntervalID=-1,chatboxAdmin.refreshInterval=5,chatboxAdmin.token="123",chatboxAdmin.init=function(){for(var s=0;s<o.init.length;s++)o.init[s]();""!==e.getCookie("chatBoxAdminToken")&&(chatboxAdmin.token=e.getCookie("chatBoxAdminToken"),$("#socketchatbox-token").val(chatboxAdmin.token)),t.register(),chatboxAdmin.getUserList()}}(),function(){"use strict";function e(e,t){var o=e-t;0!==t&&(o=(new Date).getTime()-e),o/=1e3;var s=Math.round(o%60);o=Math.floor(o/60);var i=Math.round(o%60);o=Math.floor(o/60);var a=Math.round(o%24);o=Math.floor(o/24);var n=o,c="";return n&&(c+=n+" d "),a&&(c+=a+" hr "),i&&(c+=i+" min "),c+=s+" sec"}var t=chatbox.utils;t.createNewWindowLink=function(e){return"<a target = '_blank' href = '"+e+"''>"+e+"</a>"},t.getTimeElapsed=e,t.countKeys=function(e){var t=0;for(var o in e)e.hasOwnProperty(o)&&++t;return t}}(),function(e){e.fn.drags=function(t){if(t=e.extend({handle:"",cursor:"move"},t),""===t.handle)var o=this;else var o=this.find(t.handle);return o.css("cursor",t.cursor).on("mousedown",function(o){if(""===t.handle)var s=e(this).addClass("draggable");else var s=e(this).addClass("active-handle").parent().addClass("draggable");var i=s.css("z-index"),a=s.outerHeight(),n=s.outerWidth(),c=s.offset().top+a-o.pageY,r=s.offset().left+n-o.pageX;s.css("z-index",1e3).parents().on("mousemove",function(t){e(".draggable").offset({top:t.pageY+c-a,left:t.pageX+r-n}).on("mouseup",function(){e(this).removeClass("draggable").css("z-index",i)})}),o.preventDefault()}).on("mouseup",function(){""===t.handle?e(this).removeClass("draggable"):e(this).removeClass("active-handle").parent().removeClass("draggable")})}}(jQuery),function(){"use strict";function e(){bootbox.prompt("Send Message To Selected User/Sockets",function(e){null===e||i.sendMessage(e)})}function t(){bootbox.prompt("Redirect Users/Sockets To",function(e){null===e||i.redirect(e)})}function o(){bootbox.confirm({size:"small",message:"Are you sure?",callback:function(e){e&&i.kick()}})}var s=(chatbox.utils,chatboxAdmin.ui),i=chatboxAdmin.commandHandler;s.init.push(function(){$(".socketchatbox-command-message").click(function(t){t.preventDefault(),e()}),$(".socketchatbox-command-redirect").click(function(e){e.preventDefault(),t()}),$(".socketchatbox-command-kick").click(function(e){e.preventDefault(),o()})})}(),function(){"use strict";function e(e){chatboxAdmin.refreshInterval=e,$(".socketchatbox-refresh-interval-val").text(e),o()}function t(){chatbox.socket.emit("getUserList",{token:chatboxAdmin.token}),chatboxAdmin.refreshIntervalID=setTimeout(function(){t()},1e3*chatboxAdmin.refreshInterval)}function o(){clearTimeout(chatboxAdmin.refreshIntervalID),chatboxAdmin.getUserList()}var s=(chatbox.utils,chatboxAdmin.scriptHandler,chatboxAdmin.dataHandler,chatboxAdmin.ui);s.init.push(function(){$(".socketchatbox-refresh-interval").change(function(){e(this.value)})}),chatboxAdmin.getUserList=t,chatboxAdmin.restartGetUserList=o}(),function(){"use strict";var e=(chatbox.utils,chatboxAdmin.scriptHandler),t=(chatboxAdmin.dataHandler,chatboxAdmin.ui);t.init.push(function(){var t=$(".socketchatbox-admin-input textarea");$(".prevScript").click(function(){e.prevScript()&&$(".socketchatbox-scriptHistoryScript").html(e.getScript())}),$(".nextScript").click(function(){e.nextScript()&&$(".socketchatbox-scriptHistoryScript").html(e.getScript())}),$(".cloneScript").click(function(){t.val(e.getScript())}),$("#sendScript").click(function(){var o=t.val();if(e.canSend()){t.val(""),e.sendScript(o),$(".socketchatbox-scriptHistoryScript").html(e.getScript());var s="Script is sent.";$("#socketchatbox-scriptSentStatus").text(s),$("#socketchatbox-scriptSentStatus").removeClass("redFont")}else $("#socketchatbox-scriptSentStatus").text("Must select at least one user to send script to."),$("#socketchatbox-scriptSentStatus").addClass("redFont")})})}(),function(){"use strict";function e(){$("#socketchatbox-online-users").html("Invalid Token!"),s.html("Invalid Token!"),s.addClass("error"),s.removeClass("green")}function t(){s.html("Valid Token"),s.removeClass("error"),s.addClass("green")}function o(e){chatboxAdmin.verified=!1,chatboxAdmin.token=e,i.addCookie("chatBoxAdminToken",e),chatboxAdmin.restartGetUserList()}var s,i=chatbox.utils,a=(chatboxAdmin.scriptHandler,chatboxAdmin.dataHandler,chatboxAdmin.ui);a.init.push(function(){s=$("#socketchatbox-tokenStatus"),$("#socketchatbox-updateToken").click(function(){o($("#socketchatbox-token").val())}),$(window).keydown(function(e){return 13===e.which&&$("#socketchatbox-token").is(":focus")?void o($("#socketchatbox-token").val()):void 0})}),a.badToken=e,a.validToken=t}(),function(){"use strict";function e(){s.showHistory?($(".socketchatbox-actionhistory-togglecollapse").fadeIn().css("display","inline-block"),s.$actionHistoryDiv.slideDown(function(){$(".socketchatbox-actionhistory-arrow").text(" ↑ ")})):s.$actionHistoryDiv.slideUp(function(){$(".socketchatbox-actionhistory-arrow").text(" ↓ "),$(".socketchatbox-actionhistory-togglecollapse").fadeOut()})}function t(t){var n=0;if(t.id!==i)s.$actionHistoryDiv.html(""),s.showHistory=!1,e();else{if(t.actionList.length===a)return;n=a}for(i=t.id,a=t.actionList.length,$(".socketchatbox-actionhistory-count").text(a);a>n;n++){var c=t.actionList[n],r=$("<div></div>"),d=new Date(Number(c.time)),l=i+n,u=$("<div></div>"),h=("0"+d.getHours()).slice(-2)+":"+("0"+d.getMinutes()).slice(-2)+":"+("0"+d.getSeconds()).slice(-2);h+="<span class = 'socketchatbox-actionhistory-actiontype breakable'>"+c.type+"</span>",u.html(h),u.addClass("socketchatbox-actionhistory-basic"),u.data("targetDetail",l),r.append(u);var k=$("<div></div>");k.addClass("socketchatbox-actionhistory-actiondetail");var b=$("<div></div>");b.addClass(l),b.addClass("collapse"),b.html("At: "+o.createNewWindowLink(c.url)+"<br/>"+c.detail),k.append(b),r.append(k),r.addClass("socketchatbox-userdetail-actions-each"),s.$actionHistoryDiv.append(r)}}var o=chatbox.utils,s=(chatboxAdmin.scriptHandler,chatboxAdmin.dataHandler,chatboxAdmin.ui);s.showHistory=!1;var i="-1",a=0;s.init.push(function(){s.$actionHistoryDiv=$(".socketchatbox-userdetail-actions"),s.$actionHistoryDiv.on("click",".socketchatbox-actionhistory-basic",function(){var e=$(this).data("targetDetail");$("."+e).slideToggle()}),$(".socketchatbox-actionhistory-header").click(function(){s.showHistory?s.showHistory=!1:s.showHistory=!0,e()}),e(),$(".socketchatbox-actionhistory-expandAll").click(function(){$(".socketchatbox-actionhistory-actiondetail .collapse").slideDown()}),$(".socketchatbox-actionhistory-collapseAll").click(function(){$(".socketchatbox-actionhistory-actiondetail .collapse").slideUp()})}),s.loadUserActionHistory=t}(),function(){"use strict";function e(){for(var e in s.getUserDict()){var t=s.getUserDict()[e],i=t.username;t.count>1&&(i+=" <span class='badge'>"+t.count+"<span>");var a=$("<button></button>");a.html(i),a.prop("title","Join Time: "+o.getTimeElapsed(t.joinTime)),a.addClass("username-info"),a.addClass("btn"),a.addClass("btn-default"),a.data("id",t.id);var n=$("<button></button>");t.id===s.getOpenedUserID()?(n.text(" ↑ "),n.prop("title","Close User Detail"),n.addClass("yellow"),t.arrowSpan=n):(n.text(" ↓ "),n.prop("title","Open User Detail")),n.addClass("username-info-viewmore"),n.addClass("btn"),n.addClass("btn-default"),n.data("id",t.id),t.jqueryObj=a;var c=$("<div></div>");c.addClass("btn-group"),c.addClass("socketchatbox-onlineuserlist-user"),c.append(a),c.append(n),$("#socketchatbox-online-users").append(c)}}function t(){for(var e in s.getUserDict()){var t=s.getUserDict()[e];s.userFullySelected(e)?(t.jqueryObj.removeClass("partially-selected"),t.jqueryObj.addClass("selected")):s.userPartiallySelected(e)?(t.jqueryObj.removeClass("selected"),t.jqueryObj.addClass("partially-selected")):(t.jqueryObj.removeClass("selected"),t.jqueryObj.removeClass("partially-selected"))}}var o=chatbox.utils,s=(chatboxAdmin.scriptHandler,chatboxAdmin.dataHandler),i=chatboxAdmin.ui;i.init.push(function(){$("#selectAll").click(function(){s.selectAllUsers(),i.resetAllUsersHighlight(),""!==s.getOpenedUserID()&&i.resetOpenUserSocketHighlight(s.getOpenedUserID())}),$("#selectNone").click(function(){s.selectNoSocketNorUser(),t(),""!==s.getOpenedUserID()&&i.resetOpenUserSocketHighlight(s.getOpenedUserID())})}),$(document).on("click",".username-info",function(){var e=$(this),o=e.data("id");s.toggleUserSelection(o),t(),s.getOpenedUserID()===o&&i.resetOpenUserSocketHighlight(o)}),i.renderOnlineUsers=e,i.resetAllUsersHighlight=t}(),function(){"use strict";function e(e){var t=$(".socketchatbox-userdetail-name-edit").val(),o={};o.token=chatboxAdmin.token,o.userID=e,o.newName=t,chatbox.socket.emit("admin change username",o),chatboxAdmin.restartGetUserList()}function t(e){o(e),n.loadSocketDetail(e),n.loadUserActionHistory(e)}function o(e){$(".socketchatbox-userdetail-name").text(e.username),$(".socketchatbox-userdetail-name-edit").data("name")!==e.username&&($(".socketchatbox-userdetail-name-edit").val(e.username),$(".socketchatbox-userdetail-name-edit").data("name",e.username)),$(".socketchatbox-admin-changeUserName").data("id",e.id),$(".socketchatbox-userdetail-landingpage").html()!==i.createNewWindowLink(e.url)&&$(".socketchatbox-userdetail-landingpage").html(i.createNewWindowLink(e.url)),e.referrer?$(".socketchatbox-userdetail-referrer").html(i.createNewWindowLink(e.referrer)):$(".socketchatbox-userdetail-referrer").text("N/A"),$(".socketchatbox-userdetail-ip").text()!==e.ip&&$(".socketchatbox-userdetail-ip").text(e.ip),$(".socketchatbox-userdetail-jointime").text(i.getTimeElapsed(e.joinTime)),$(".socketchatbox-userdetail-totalmsg").text()!==e.msgCount&&$(".socketchatbox-userdetail-totalmsg").text(e.msgCount),e.lastMsg||(e.lastMsg="N/A"),$(".socketchatbox-userdetail-lastmsg").text()!==e.lastMsg&&$(".socketchatbox-userdetail-lastmsg").text(e.lastMsg),$(".socketchatbox-userdetail-lastactive").text()!==i.getTimeElapsed(e.lastActive)&&$(".socketchatbox-userdetail-lastactive").text(i.getTimeElapsed(e.lastActive)),$(".socketchatbox-userdetail-useragent").text()!==e.userAgent&&$(".socketchatbox-userdetail-useragent").text(e.userAgent),$(".socketchatbox-userdetail-room").text()!==e.roomID&&$(".socketchatbox-userdetail-room").text(e.roomID)}function s(){var e=a.getOpenedUserID();e in a.getUserDict()?(t(a.getUserDict()[e]),n.resetOpenUserSocketHighlight(e)):a.setOpenedUserID("")}var i=chatbox.utils,a=(chatboxAdmin.scriptHandler,chatboxAdmin.dataHandler),n=chatboxAdmin.ui;n.init.push(function(){$(".socketchatbox-admin-lookupIP").click(function(){window.open("https://geoiptool.com/en/?ip=")}),$(window).keydown(function(t){if(13===t.which&&$(".socketchatbox-userdetail-name-edit").is(":focus")){var o=$(".socketchatbox-admin-changeUserName").data("id");return void e(o)}})}),$(document).on("click",".username-info-viewmore",function(){var e=$(this),o=e.data("id"),s=a.getUserDict()[o];if(a.getOpenedUserID()===o)$(".socketchatbox-admin-userdetail-pop").slideUp(),e.text(" ↓ "),e.removeClass("yellow"),a.setOpenedUserID("");else{var i=a.getOpenedUserID();if(i in a.getUserDict()){var c=a.getUserDict()[i];c.arrowSpan.text(" ↓ "),c.arrowSpan.removeClass("yellow")}e.text(" ↑ "),e.addClass("yellow"),a.setOpenedUserID(o),s.arrowSpan=e,t(s),$(".socketchatbox-admin-userdetail-pop").is(":visible")||$(".socketchatbox-admin-userdetail-pop").slideDown(),n.resetOpenUserSocketHighlight(o)}}),$(document).on("click",".socketchatbox-admin-changeUserName",function(){var t=$(this),o=t.data("id");e(o)}),n.renderOpenedUserDetail=s}(),function(){"use strict";function e(){a.showAliveSocket?$(".socketchatbox-userdetail-sockets").slideDown(function(){$(".socketchatbox-livesockets-arrow").text(" ↑ ")}):$(".socketchatbox-userdetail-sockets").slideUp(function(){$(".socketchatbox-livesockets-arrow").text(" ↓ ")})}function t(t){t.id!=n&&(n=t.id,a.showAliveSocket&&(a.showAliveSocket=!1,e())),$(".socketchatbox-userdetail-sockets").html(""),$(".socketchatbox-livesockets-count").text(t.socketList.length);for(var o=0;o<t.socketList.length;o++){var i=t.socketList[o],c=$("<div></div>"),r="<center>["+o+"]</center>";c.html(r);var d=$("<div></div>"),l="<table class='table table-bordered'><tbody>";l+="<tr><td>ID</td><td class='breakable'>"+i.id+"</td></tr>",l+="<tr><td>URL</td><td class='breakable'>"+s.createNewWindowLink(i.url)+"</td></tr>",i.referrer&&(l+="<tr><td>Referrer</td><td class='breakable'>"+s.createNewWindowLink(i.referrer)+"</td></tr>"),l+="<tr><td>IP</td><td>"+i.ip+"</td></tr>",l+="<tr><td>Total Messages</td><td>"+i.msgCount+"</td></tr>",i.lastMsg&&(l+="<tr><td>Last Message</td><td class='breakable'>\""+i.lastMsg+'"</td></tr>'),l+="<tr><td>Idle Time</td><td>"+s.getTimeElapsed(i.lastActive)+"</td></tr>",l+="<tr><td>Connection Time</td><td>"+s.getTimeElapsed(i.joinTime)+"</td></tr>",l+="</tbody></table>",d.html(l),c.addClass("socketchatbox-socketdetail-each"),c.data("id",i.id),i.jqueryObj=c,$(".socketchatbox-userdetail-sockets").append(c),$(".socketchatbox-userdetail-sockets").append(d)}}function o(e){for(var t=i.getUserDict()[e],o=0;o<t.socketList.length;o++){var s=t.socketList[o];i.userFullySelected(t.id)||i.socketSelected(s.id)?s.jqueryObj.addClass("selectedSocket"):s.jqueryObj.removeClass("selectedSocket")}}var s=chatbox.utils,i=(chatboxAdmin.scriptHandler,chatboxAdmin.dataHandler),a=chatboxAdmin.ui,n="-1";a.showAliveSocket=!1,a.init.push(function(){$(".socketchatbox-livesockets-header").click(function(){a.showAliveSocket?a.showAliveSocket=!1:a.showAliveSocket=!0,e()}),e()}),$(document).on("click",".socketchatbox-socketdetail-each",function(){var e=$(this),t=e.data("id"),o=i.getSocketDict()[t],s=o.user;i.toggleSocketSelection(t),a.resetAllUsersHighlight(),a.resetOpenUserSocketHighlight(s.id)}),a.loadSocketDetail=t,a.resetOpenUserSocketHighlight=o}(),function(){"use strict";function e(e,o){var s={};s.token=chatboxAdmin.token,s.content=o,s.userKeyList=t.getSelectedUserList(),s.socketKeyList=t.getSelectedSocketList(),s.type="admin "+e,chatbox.socket.emit("admin command",s)}var t=(chatbox.utils,chatboxAdmin.dataHandler),o=chatboxAdmin.commandHandler;o.canSend=function(){var e=t.selectedUsersCount(),o=t.selectedSocketsCount();return e+o>0},o.sendMessage=function(t){e("message",t)},o.redirect=function(t){e("redirect",t)},o.kick=function(){e("kick")}}(),function(){"use strict";function e(e){var t=h[e];delete b[e],delete x[e],t.selectedSocketCount=0;for(var o=0;o<t.socketList.length;o++){var s=t.socketList[o];s.selected=!1,delete m[s.id]}}function t(e){var t=h[e];b[e]=t,delete x[e],t.selectedSocketCount=t.count;for(var o=0;o<t.socketList.length;o++){var s=t.socketList[o];s.selected=!0,delete m[s.id]}}function o(o){o in b?e(o):(e(o),t(o))}function s(e){var t=k[e],o=t.user;t.selected?(t.selected=!1,o.selectedSocketCount--):(t.selected=!0,o.selectedSocketCount++),i(o)}function i(o){o.selectedSocketCount===o.count?(e(o.id),t(o.id)):o.selectedSocketCount>0?(x[o.id]=o,c(o),delete b[o.id]):e(o.id)}function a(){b={},m={},x={};for(var t in h){var o=h[t];e(o.id)}}function n(){for(var e in h){var o=h[e];t(o.id)}}function c(e){for(var t=0;t<e.socketList.length;t++){var o=e.socketList[t];o.selected?m[o.id]=o:delete m[o.id]}}function r(){for(var e in b)e in h?t(e):delete b[e];for(var e in x)if(e in h){for(var o=h[e],s=0;s<o.socketList.length;s++){var a=o.socketList[s];a.id in m&&(a.selected=!0,o.selectedSocketCount++)}i(o)}else delete x[e];for(var n in m)n in k||delete m[n]}function d(e){h=e,k={};for(var t in h){var o=h[t];o.selectedSocketCount=0,o.count=o.socketIDList.length;for(var s=0;s<o.socketList.length;s++){var i=o.socketList[s];i.user=o,i.selected=!1,k[i.id]=i}}r()}var l=chatbox.utils,u=chatboxAdmin.dataHandler,h={},k={},b={},m={},x={},p="default";u.getUserDict=function(){return h},u.getSocketDict=function(){return k},u.getOpenedUserID=function(){return p},u.setOpenedUserID=function(e){p=e},u.userFullySelected=function(e){return e in b},u.userPartiallySelected=function(e){return e in x},u.socketSelected=function(e){return e in m},u.selectedUsersCount=function(){return l.countKeys(b)},u.selectedSocketsCount=function(){return l.countKeys(m)},u.getSelectedUsers=function(){return b},u.getSelectedSockets=function(){return m},u.getSelectedUserList=function(){var e=[];for(var t in u.getSelectedUsers())e.push(t);return e},u.getSelectedSocketList=function(){var e=[];for(var t in u.getSelectedSockets())e.push(t);return e},u.toggleUserSelection=o,u.toggleSocketSelection=s,u.selectNoSocketNorUser=a,u.selectAllUsers=n,u.loadUserSocketFromServer=d}(),function(){"use strict";function e(e){var s={};s.token=chatboxAdmin.token,s.content=e,s.userKeyList=o.getSelectedUserList(),s.socketKeyList=o.getSelectedSocketList(),s.type="admin script",chatbox.socket.emit("admin command",s),t(e)}function t(e){i.push(e),a=i.length-1}var o=(chatbox.utils,chatboxAdmin.dataHandler),s=chatboxAdmin.scriptHandler;s.canSend=function(){var e=o.selectedUsersCount(),t=o.selectedSocketsCount();return e+t>0},s.sendScript=e;var i=[],a=-1;s.pushScript=t,s.getScript=function(){return a>=0&&a<i.length?i[a]:""},s.nextScript=function(){return a<i.length-1?(a++,!0):!1},s.prevScript=function(){return a>0?(a--,!0):!1}}(),function(){"use strict";var e=(chatbox.utils,chatboxAdmin.ui),t=chatboxAdmin.dataHandler;chatboxAdmin.verified=!1;var o=chatboxAdmin.socketEvent;o.register=function(){var o=chatbox.socket;o.on("server stat",function(e){var t=$("<p></p>");t.html("<p>Welcome, Admin! </p><p>The Chatbox was started on "+e.chatboxUpTime+".</p><p>There have been "+e.totalUsers+" users, "+e.totalSockets+" sockets and "+e.totalMsg+" messages.</p>"),t.addClass("server-log-message"),$(".socketchatbox-admin-server").append(t),$(".socketchatbox-admin-server")[0].scrollTop=$(".socketchatbox-admin-server")[0].scrollHeight}),o.on("room stat",function(e){var t=$("<p></p>");t.html("<p>Welcome, Room Admin! </p><p>The Room was opened on "+e.createTime+".</p><p>There have been "+e.totalUsers+" users, "+e.totalSockets+" sockets and "+e.totalMsg+" messages.</p>"),t.addClass("server-log-message"),$(".socketchatbox-admin-server").append(t),$(".socketchatbox-admin-server")[0].scrollTop=$(".socketchatbox-admin-server")[0].scrollHeight}),o.on("server log",function(e){var t=$("<p></p>"),o=new Date,s=$("<span></span");s.addClass("log-time");var i=("0"+o.getHours()).slice(-2)+":"+("0"+o.getMinutes()).slice(-2)+":"+("0"+o.getSeconds()).slice(-2);s.text(i),t.append(s),t.append(e.log),t.addClass("server-log-message"),$(".socketchatbox-admin-server").append(t),$(".socketchatbox-admin-server")[0].scrollTop=$(".socketchatbox-admin-server")[0].scrollHeight}),o.on("listUsers",function(s){$("#socketchatbox-online-users").html(""),s.success?(e.validToken(),chatboxAdmin.verified||(chatboxAdmin.verified=!0,o.emit("getServerStat",{token:chatboxAdmin.token})),t.loadUserSocketFromServer(s.userdict),e.renderOnlineUsers(),e.resetAllUsersHighlight(),e.renderOpenedUserDetail()):($("#socketchatbox-online-users").html("Invalid Token!"),e.badToken())})}}(),function(){"use strict";function e(){setTimeout(function(){t()?chatboxAdmin.init():setTimeout(function(){e()},1e3)},1e3)}function t(){return"undefined"!=typeof chatbox&&"undefined"!=typeof chatbox.socket&&chatbox.socket.joined}t()?chatboxAdmin.init():e()}();